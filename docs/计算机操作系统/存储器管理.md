计算机执行时, 几乎每一条指令都涉及对存储器的访问.

理想存储器:
1. 速度快
2. 大容量
3. 便宜
how: 多层结构的存储器系统

## 多层结构的存储器系统
what:
对于通用计算机, 至少有三级存储层次
1. CPU寄存器
2. 主存(高速缓存, 主存储器, 磁盘缓存) 属于操作系统存储管理
3. 辅存(固定磁盘, 可移动存储介质) 属于操作系统设备和文件管理



### 可执行存储器
寄存器和主存被称为可执行存储器, 与存放在辅存中的信息采用不同的访问机制

进程可以在很少的时钟周期内使用load和store指令对可执行存储器进行访问, 但是对于辅存的访问需要通过I/O设备实现, 期间涉及中断, 设备驱动程序, 以及物理设备的运行, 访问速度与主存访问速度相差3个数量级

> 操作系统存储管理负责对可执行存储器的分配, 回收, 以及提供在存储层次间数据的移动和管理的机制


## 主存储器与寄存器
### 主存(内存)
主要部件, 用于保存进程运行时程序和数据, 也成为可执行存储器. 通常处理机都是从主存储中取得指令和数据, 并将所取得的指令放入**指令寄存器**, 取得数据放入数据寄存器; 或者反之. 
存储容量的发展得益于VLSI(大规模集成电路)
> Very-large-scale integration (VLSI) is the process of creating an integrated circuit (IC) by combining thousands of transistors into a single chip

### 寄存器
寄存器和处理机具有相同的速度, 所以对寄存器的访问速度最快.

### 高速缓存和磁盘缓存

## 程序的装入和链接
程序要在系统中运行, 必须先将它装入内存, 然后再将其转变为一个可执行的程序
1. 编译, 编译程序(Compiler)对源程序进行编译,形成若干目标模块(Object Module)
2. 链接, 链接程序(Linker)将编译后形成的一组目标模块以及它们所需要的库函数链接在一起, 形成一个完整的装入模块(Load Module)
3. 装入, 装入程序(Loader)将装入模块装入内存

### 程序的装入
1. 绝对装入方式(Absolute Loading Mode)
   1. 适用与计算机系统很小, 且仅能运行单道程序时.
2. 可重定位装入方式(Relocation Loading Mode)
   1. 地址的转换在进程装入时一次完成
3. 动态运行时的装入方式(Dynamic Run-time Loading)
   1. 运行时程序和数据在内存中的位置可能经常要改变. 例如具有对换功能的系统中,一个进程可能被多次换出, 有多次换入, 每次换入的位置通常时不同的

### 程序的链接
链接程序的功能时将这组目标模块以及它们所需要的库函数装配成一个完整的装入模块

1. 静态链接方式(Static Linking)
   1. 在程序运行之前，先将给目标模块即它们所需的库函数连接成一个完整的装配模块
      1. 修改相对地址
      2. 变换外部调用符号
2. 装入时动态链接(Load-time Dynamic Linking)
   1. 便装入边链接. 在装入一个目标模块的时候, 若发生一个外部模块调用事件, 装入程序去寻找相应的外部目标模块
      1. 便于修改和更新
      2. 便于实现对模块的共享
3. 运行时动态链接(Run-time Dynamic Linking)
   1. 对某些模块的链接推迟到程序执行时才进行.

## 连续分配存储管理方式
1. 单一连续分配
2. 固定分区分配
3. 动态分区分配
4. 动态可重定位分区分配

### 单一连续分配
分为系统分区和用户分区，用户分区仅有一道程序

### 固定分区分配
1. 分区方法
   1. 分区大小相等
   2. 分区大小不等
2. 内存分配
   1. 分区使用表

### 动态分区分配
所用的数据结构、分区分配算法, 分区的分配与回收操作

#### 数据结构
1. 空闲分区表
2. 空闲分区链

#### 分配算法
1. 顺序式搜索算法
2. 索引式搜索算法

#### 基于顺序搜索的动态分区分配算法(比较适用于不太大的系统)
3. 首次适应
4. 循环首次适应
5. 最佳适应
6. 最坏适应


#### 基于索引搜索的动态分区分配算法
1. 快速适应算法
2. 伙伴系统
3. 哈希算法


### 动态可重定位分区分配
1. 紧凑
   1. 通过移动内存中作业的位置，把原来多个分散的小分区拼接成一个大分区
   2. 获得了空间，但是用户程序在内存中的位置发生了变化, 这个时候需要对程序和数据的位置进行修改, 影响系统的运行效率
2. 动态重定位
   1. 借助重定位寄存器(存放了程序数据在内存中的起始地址), 程序执行时真正的访问的内存地址时相对地址与重定位寄存器中的地址相加得到的
3. 动态重定位分区分配算法
   1. 与动态分区分配算法基本相同, 差别在于, 此算法中增加了紧凑的功能

## 对换(Swapping)
对换提高了内存的利用率, 直接提高处理的利用率和系统的吞吐量.


单用户分时系统: 系统把所有用户的作业放在磁盘上, 每次只能调入一个作业进入内存
多道程序环境: 把内存中暂时不能运行的进程或者暂时不用的程序和数据换出到外存上, 以便腾出足够足够的内存空间, 在把已具备运行条件的进程或进程所需要的程序和数据换入内存. 
### 多道程序环境下的对换技术
多道程序环境下, 一方面在内存中的某些进程由于某事件尚未发生未被阻塞运行, 却占用了大量的内存, 甚至有时内存中的所有进程都被阻塞. 迫使CPU停止下来等待的情况. 另一方面却又许多作业,因为内存空间不足, 一直驻留在外存上, 而不能进入内存运行

对换的类型: 
1. 整体对换(中级调度)
2. 页面(分段)对换, 如果对换时以进程的一个**页面**或**分段**为单位进行的, 分别成为**页面对换**或**分段对换**, 又统称**部分对换**. 这种对换方法时实现后面讲到的请求分页和请求分段式存储管理的基础

### 对换空间的管理
在具有对换功能的OS中, 通常把磁盘空间分为文件区和对换区两部分

#### 对换空间管理的主要目标
1. 文件区管理的目标(提高空间利用率, 然后才是提高文件的访问速度)
2. 对换空间管理的主要目标(提高进程换入和换出的速度, 然后才是提高文件存储空间的利用率)

#### 对换区空闲块管理中的数据结构
数据结构形式与内存在动态分区分配方式所用的数据结构相似, 同样的**空闲分区表法**和**空闲分区链**

### 对换空间的分配和回收
与动态内存分配
1. 首次适应算法
2. 循环首次适应算法
3. 最佳适应算法

### 进程的换入和换出

 